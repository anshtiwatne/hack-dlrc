from random import randint, shuffle
import json


def generate_problem() -> str:
    ELEMENTS = [chr(i) for i in range(ord("A"), ord("Z") + 1)]
    eqs = []
    for _ in range(256):
        shuffle(ELEMENTS)
        es = [ELEMENTS[i] for i in range(0, randint(2, 8))]
        lcs = [randint(1, 256) for _ in range(len(es))]
        rcs = [randint(1, 256) for _ in range(len(es))]

        mt = ""
        eq = f"{' + '.join(f'{e}{c if c > 1 else mt}' for (e, c) in zip(es, lcs))} -> {''.join(f'{e}{cf * cn}' for (e, cf, cn) in zip(es, lcs, rcs))}"
        eqs.append(eq)
    return "\n".join(eqs)


def solve(s: str) -> int:
    eqs = s.splitlines()
    output = 0
    for eq in eqs:
        lhs, rhs = eq.split("->")
        rhs = rhs.strip()

        reactants = {
            t[0]: int(t[1:] if len(t) > 1 else 1)
            for t in list(map(lambda s: s.strip(), lhs.split("+")))
        }
        products = {}

        i = 0
        while i < len(rhs):
            e = rhs[i]
            i += 1
            j = i

            while i < len(rhs) and rhs[i] in "0123456789":
                i += 1
            products[e] = int(rhs[j:i]) if i != j else 1

        for i in reactants.keys():
            output += products[i] / reactants[i]

    return int(output)


if __name__ == "__main__":
    p = generate_problem()
    s = solve(p)
    print(p)
    print(s)

print(
    solve(
        """K87 + J207 + M195 + E64 + F238 + A69 + C184 + P188 -> K6612J11799M48555E7936F1904A13731C39192P32900
T167 + A115 + B27 -> T25384A9660B3996
G230 + L151 + D60 + F49 + N210 + E222 + U13 -> G41170L38656D1020F10045N20790E54390U676
Y123 + D5 + S241 + Q209 + P15 + F252 + N51 -> Y9471D870S52056Q22572P2835F49392N3825
I142 + B81 + H133 + K76 -> I27122B4455H21413K9804
U197 + O133 + K118 -> U16548O2660K23482
U110 + O95 + L107 -> U21890O3135L15087
W221 + O133 + D29 + F208 + N37 + U188 + R82 -> W22763O15295D6032F17680N3737U34216R17220
X48 + L109 + Q165 + O3 + E249 + I201 + Z221 -> X6480L25070Q10890O210E2739I37788Z30498
C106 + S175 + D43 -> C26606S27475D8385
A214 + K127 + S205 + X131 + E141 + U40 + G94 -> A27178K1143S6560X24104E3807U7440G15604
G176 + Q30 + U79 + K79 + O67 + L84 + D100 + R175 -> G15840Q5130U14694K10902O1407L6132D21700R1750
A39 + Z208 + J249 -> A7449Z8112J25896
S40 + F124 -> S2720F28272
Z31 + W19 + F167 + B165 + K193 + R132 + A107 -> Z6572W2793F3674B10560K20072R8316A2568
I133 + P150 + J212 + O248 + B50 + K103 + Q152 + W45 -> I3458P11400J13144O44392B8800K8137Q27208W9180
Y32 + M14 + P149 + K138 + E140 -> Y7744M1540P35164K23874E14140
M5 + F36 + G133 + A137 + B71 + H178 -> M1240F3708G8645A34387B6319H30438
V57 + E207 -> V6270E29808
C54 + U202 + Z154 + K159 + B142 + V191 -> C162U41410Z8316K26712B2698V40683
W55 + X152 + E79 + N64 + G39 + H16 + Z253 -> W6215X12160E7900N5632G4446H3888Z12397
Y231 + Q251 + L36 + E217 + W212 + J12 + M87 -> Y39039Q23343L3384E32333W1696J2376M9135
Y192 + S125 -> Y24768S3375
W58 + L121 + Z66 + S254 + D243 -> W3480L26015Z14916S42164D32562
C122 + P44 + N236 + L61 + J72 -> C16104P6292N13216L3050J18072
D153 + N123 + W161 -> D306N19434W38801
Z231 + U123 + W116 + E26 + J181 + S181 + C65 + G203 -> Z51282U19680W4292E754J45431S38372C16120G23751
X217 + G222 + J195 + L114 + A171 + B248 + Q92 + S36 -> X5642G8658J3120L4218A7011B42904Q16284S5940
D180 + Q92 + R158 + O57 + P188 + C188 + W83 -> D42480Q1564R20066O12540P39668C28388W4814
I249 + N2 + M250 + J94 + H155 + D116 + L116 + V13 -> I43575N340M10500J23312H31465D25520L18328V3146
J185 + N181 + G216 + S95 + E27 + P150 -> J13320N30408G1296S11020E486P10950
P77 + G15 + E183 + K55 + M188 + Q20 -> P17248G3750E28548K11385M25568Q1080
A224 + Z175 + B119 -> A25312Z40600B2380
Q152 + P195 + W64 + A45 + U139 + B218 + J70 -> Q14592P46800W13312A5355U15568B52756J17010
G229 + C43 + F159 + J32 + Z184 + K64 + E205 -> G31373C6837F3180J608Z27784K9280E24600
W65 + C133 + G80 + I205 + Y18 + V4 + X110 -> W15275C9842G12480I36900Y576V512X16500
X223 + J84 + E19 -> X22746J18144E969
K + D100 + G182 -> K45D16100G21476
B224 + I112 + X226 + H210 + V183 + D41 + Z199 + W141 -> B10304I11424X46782H4620V44103D7667Z29054W17061
A78 + Q213 + H134 -> A14118Q24921H19966
L218 + K5 + J247 -> L19402K825J18031
E158 + N114 + W219 + A130 + R144 + C41 + I67 + M95 -> E9480N14706W42705A1690R16128C697I10117M190
T7 + E77 + P152 + K202 + M141 -> T798E16247P30856K24240M22137
D123 + I23 + Z126 -> D13530I1564Z16506
U182 + Y234 -> U2002Y43056
C149 + K172 + J122 + P222 + A133 + I149 + M148 -> C20115K29412J16226P37074A3724I1043M28712
U21 + A118 + I31 + H243 + Z66 -> U2667A25842I6541H33291Z2904
S191 + D15 + Z118 + T5 -> S6876D3150Z22774T170
R40 + V84 + P200 + Q95 + T248 + U234 + M21 -> R5480V5292P37600Q19285T26536U702M2247
G103 + Y70 + N210 -> G11948Y10430N22680
B195 + V209 + T20 + S138 + H35 + W176 + Y132 + J197 -> B5850V29887T4700S25668H8820W42944Y23892J43340
C173 + O142 -> C14359O21726
E42 + B96 + V158 + Y177 + K189 + H111 -> E3822B18624V23226Y18762K32508H28194
C195 + J129 + H150 + A14 + F250 -> C19890J29541H2400A2758F44250
V30 + A117 + J180 + D12 + C167 -> V6990A24921J16020D636C17535
F173 + P18 -> F20760P450
Z143 + N81 + H168 + B130 + F129 + X245 -> Z8580N10125H30240B31460F27219X14700
Y28 + E195 + P57 + K251 + T180 -> Y5600E18525P6384K17068T12960
V212 + K41 -> V36676K5043
T134 + K28 + Q97 + B59 + M180 + J125 + A24 + Y228 -> T21574K6888Q1455B12626M30240J8875A3120Y27132
B126 + R88 + A142 + J101 + K230 + O204 -> B1008R12144A21442J1616K40250O18360
M22 + G249 + R120 + V182 -> M2376G25149R19800V44226
N65 + Y233 + Q240 + T253 + F103 + O198 + S186 + J9 -> N9295Y22368Q5280T20746F16480O24750S37572J630
U128 + M61 + T44 + Z218 -> U16256M12017T6864Z5886
R215 + P75 + K5 + W116 -> R14190P6375K570W23664
V183 + H18 + U144 -> V32391H4392U13968
I83 + T131 + V98 + J94 -> I14525T33405V3136J2444
Q36 + K95 + N163 + P187 + L63 + V145 -> Q4896K15295N25102P6545L3465V2610
D37 + A135 + U33 -> D5624A7830U3432
B180 + I61 + A183 + C221 + J178 -> B39060I14823A12627C49504J1958
O181 + F205 + B114 + Y228 + V24 + T222 + S183 -> O17738F4510B24852Y28956V576T11766S24522
C98 + P111 -> C18130P28194
K37 + W56 + S47 + T215 + E34 + L248 -> K7770W6048S2350T12685E1700L23808
B127 + T58 + E220 + W41 + P20 + F146 + Y19 -> B13208T986E26180W9225P3200F32266Y4769
H245 + Q42 + W127 + X104 + P152 + S237 + M85 -> H3675Q8148W29083X25168P9120S49059M14790
D22 + I65 + X150 + P98 + N51 + A66 + W65 + C139 -> D5456I13390X21000P3332N10710A8184W2795C29746
Z178 + N73 -> Z9612N15549
K37 + H120 -> K1147H2400
R94 + P227 + Z7 + T58 + F73 + Q52 + M180 + X70 -> R17296P20430Z476T13224F1533Q2392M36540X4690
Q171 + W14 -> Q10773W1890
J156 + R89 + N86 + Z90 + S195 -> J24804R10146N15480Z13770S12480
B76 + G49 + V55 -> B13148G10780V3795
D + L115 + V4 -> D82L17020V616
Z154 + M160 -> Z37884M26880
I210 + P232 + L42 + Q214 + M88 + X26 + Y217 -> I44730P35496L2352Q11770M22264X338Y22568
D2 + W27 + T152 + V100 + J201 + I56 -> D488W4185T22952V12200J41004I336
D45 + V236 + L202 -> D8865V10148L42016
L91 + P48 + T238 + N131 + C151 + G209 + F131 + J18 -> L19474P3552T27846N20043C7701G14630F25545J2466
K50 + U136 + B104 + X128 + F181 + E83 + S223 -> K12700U28152B20800X5504F17738E6972S40586
T75 + U119 + Z150 + L54 + C68 + Y69 + S136 -> T13200U3927Z28500L6156C9180Y14421S952
C155 + P216 + E29 + T163 + K93 + Z76 + R4 -> C27745P41904E7250T22494K23064Z11172R192
B113 + Y137 + I181 + U136 + N202 + E153 + S78 -> B7797Y30277I20091U29920N33330E6579S4134
K234 + U69 + Z95 + C28 -> K33930U13386Z21185C2996
N256 + X218 + R248 + A37 -> N4096X11118R4216A1850
I11 + X126 -> I352X1638
K126 + H8 + X76 + P209 + F170 + O242 + T12 -> K15246H504X11856P1672F4930O242T804
A247 + V186 + P122 + G18 -> A47918V37014P3904G1098
G145 + X53 + R72 + M158 + N137 + Y255 + K68 + C228 -> G22330X13091R15336M33338N822Y42585K9112C56544
I198 + K106 + D8 + N234 + E243 + H19 -> I48708K13144D728N42120E41310H1368
T175 + W20 + J233 + Q13 + L102 -> T25375W4200J45435Q611L25704
D95 + F22 -> D11685F2662
M114 + E120 + K22 -> M20862E28560K1012
L66 + Q58 -> L15708Q10092
F228 + G16 -> F25992G2320
K73 + L188 + G85 -> K10950L9400G16235
L140 + T78 + U234 + Y129 + C244 + G209 -> L9940T1716U17082Y13545C10248G45980
R167 + K20 -> R13694K180
H36 + M63 + U32 + V211 + B111 + P31 -> H4644M14175U4512V49796B11211P7502
G22 + T9 + Y53 -> G3982T315Y6466
O66 + N209 + E148 + S159 + Y147 + F116 -> O13134N18810E13320S14787Y27195F13456
Y19 + P21 + F107 + C85 + R245 + V232 + U115 -> Y4066P105F8025C9010R20825V2552U1840
T74 + R178 + I78 + A82 -> T10952R25454I2808A3608
S183 + Q121 + D225 + X135 + I208 + B252 + K18 + G140 -> S16287Q4477D46575X22545I18304B13356K864G3080
P184 + S181 + O110 + K84 + B124 -> P24472S13575O13200K13860B13020
I105 + C253 + N56 + E203 + Z193 + L171 -> I13650C8349N10248E47908Z46899L33003
U111 + R87 + Q124 + X240 + E171 -> U3330R9483Q24304X23280E34542
Y186 + I43 + W27 + B66 + L120 + T66 + Q48 + P239 -> Y45012I7869W4725B14718L20040T12210Q8736P37284
V223 + K102 + P255 + Z108 -> V54189K25296P35955Z8424
O144 + H22 + F39 + Q147 + K5 + J76 + W202 + C245 -> O18720H4224F78Q36456K780J5320W19594C56105
Q216 + T166 + H218 + D155 -> Q5400T25564H48178D7130
O87 + C132 + B125 -> O14181C26532B18625
Y21 + P132 + U215 + I124 + K134 + E162 + G92 + O209 -> Y3339P12408U23220I6448K33500E28998G5612O16093
R230 + M250 + Z26 + N42 + K83 + Y201 + V18 -> R55890M31250Z1820N10458K17845Y23718V180
X217 + Z216 + U37 + V12 + T130 + K191 -> X12586Z44496U6586V720T29510K20437
T57 + K149 + F206 -> T11286K32929F37904
I45 + E42 + Y50 + N208 + R165 + K223 + U34 -> I9180E2772Y11150N29120R9405K32112U7412
R249 + G210 + I73 -> R41583G12810I1095
J235 + V64 + O111 + M55 + E140 -> J47705V14848O26196M605E23800
S22 + E10 + L161 + W217 + A75 + O158 -> S2618E2010L19320W13237A8025O18012
R55 + Y206 -> R12650Y15862
I111 + S58 + M112 -> I19425S7482M18368
R112 + W185 + B147 + N127 + J4 + K62 + Y247 + F7 -> R9968W34410B3675N30734J892K12648Y41496F882
N55 + O117 -> N12760O25272
Y152 + B39 + W163 -> Y38000B5733W24776
E173 + D162 + T176 + I203 + S58 + P205 + V117 -> E9515D26082T23760I34104S9918P25010V15444
Q135 + F67 + N53 + D217 -> Q135F6968N5883D26691
F106 + Q241 + D10 + M89 -> F4664Q53020D1760M5429
P121 + Q13 + U139 -> P25168Q1677U9869
M82 + E2 -> M5412E454
A14 + I192 + M85 + S111 + F199 + T96 -> A1848I16128M11645S22422F45571T12672
M122 + P58 + J181 + R3 + D88 + Q3 + A223 -> M11590P3248J31132R282D16544Q621A20293
Q115 + K159 + X244 + W233 + O57 -> Q9545K31959X7320W32620O9861
L251 + C248 -> L26355C4712
O140 + T68 + C231 + E130 + K70 -> O30940T16524C13167E27560K11550
K52 + S155 + L15 -> K7748S11935L3405
R222 + G95 + I44 -> R18426G14060I616
G203 + E223 + V38 + Q250 + C113 + D171 + Y221 + T162 -> G32480E16725V4978Q18500C27346D25650Y32045T29160
P36 + N236 + R169 -> P7956N41772R8450
I99 + S99 + H20 + F22 + P131 -> I8415S20592H1620F5434P14541
H187 + S110 + E241 + R7 + W212 + P201 + U192 -> H2057S26180E16388R1771W34768P7638U35712
K77 + Y23 + M29 + P84 + Z97 + B87 + C17 -> K10241Y207M6351P3192Z1843B15312C2448
W206 + B30 + I119 + H202 + Y79 -> W5562B6240I18683H4444Y15800
B234 + G16 + A13 + I101 + P254 + S209 + N97 -> B5148G1552A2301I9898P17018S3135N4559
K191 + Y238 + Q26 + J190 + B73 + C31 -> K2101Y43316Q4108J3990B16425C1612
J102 + M75 + C55 + U168 -> J19890M17175C12320U33096
V91 + G185 + Q212 -> V9646G35335Q4664
T7 + F147 + H81 + S43 + P202 + B251 + E103 -> T672F37338H5670S8127P43632B4518E26059
D165 + O60 + C150 + R91 + V102 + K152 -> D16830O2280C3750R14378V18258K456
D163 + V213 -> D17604V20235
F249 + J107 + D223 + Q5 -> F5478J25787D29436Q430
W249 + X38 + F219 + K88 + O25 + I66 -> W21663X4446F30441K2640O1275I7722
D + H245 -> D113H7595
C10 + K144 + Z219 + Y24 + G240 + U80 -> C2430K31248Z44238Y2376G16800U6800
N171 + W233 -> N34884W39843
Q126 + R249 + A38 + X33 + Z127 -> Q14238R49800A4218X2607Z25146
B51 + Y209 + W225 + M73 + P219 + Z199 + J84 -> B11934Y48279W43650M17374P28689Z13731J17808
H6 + F68 + X165 + E246 + K5 + U83 + C107 -> H1338F6460X1815E38622K870U15521C17013
G150 + U10 + S67 + M127 + B15 + F240 + Y124 -> G3750U1740S11658M14224B870F18480Y12400
Y138 + W66 + Q96 + K19 + V210 -> Y8832W9174Q7392K3743V17010
V157 + U143 + D195 + F251 + Z208 + R174 + P69 + M21 -> V16956U33748D48165F12801Z10816R32016P966M3780
W202 + Y46 + J221 + U37 + Q29 + N161 -> W2424Y8556J47073U1147Q7134N26243
B138 + F64 + Y50 + H198 + Q156 -> B8970F7552Y150H28710Q14352
Q114 + P106 + I57 + B55 + M164 + R231 + E235 -> Q3648P11554I9177B6380M1312R2310E47000
W48 + H170 + U44 + Z8 + B46 + D233 + R26 + E143 -> W10224H41480U2068Z1200B8142D54056R4940E29029
M58 + C32 + D141 + A72 + L92 + X212 + K127 + S30 -> M6960C1376D20868A4752L3680X48336K24384S5160
A179 + T38 + Y -> A44750T1596Y182
R231 + M151 + T162 + B11 + J8 + W171 + X63 -> R33033M30955T22032B1540J1584W684X12789
A107 + E19 + K39 + U27 + S8 + H83 -> A22684E1577K6591U5697S1144H20335
V159 + F237 + J114 + Y96 + Q201 + N74 + H235 -> V17808F18960J3534Y3552Q42009N3552H37600
W254 + Q181 + T160 + L152 -> W8382Q46155T34880L3496
Q101 + J94 + E186 -> Q2727J1034E3720
U220 + M143 -> U19800M29601
H172 + D99 + E109 + C92 -> H32336D11979E218C21252
O119 + Z4 -> O15232Z340
J45 + Z253 + Y242 + R178 + E131 -> J8910Z56419Y40898R15664E4454
V59 + C242 + I63 + X221 + M56 -> V2006C41866I5607X28288M1904
M177 + U155 + P156 -> M36462U4805P12324
U21 + J194 + C237 -> U2709J12998C37683
X99 + E23 -> X15543E5428
Q144 + H246 + A188 + E236 + M144 + T105 + U107 -> Q25920H11316A2820E35636M7776T24045U26001
Y59 + F136 + H30 + I166 -> Y9735F23392H3960I10624
C35 + Q81 + R163 + U135 + N116 + M186 -> C8820Q8667R18419U2700N9628M1674
A140 + U188 + X27 + K16 + C97 + I110 -> A5600U9964X6642K2352C3007I7920
A177 + V132 + H63 + U206 + T163 -> A21240V13992H11025U46144T27058
Z174 + T183 + H236 + E70 -> Z19836T42456H43660E3780
Q174 + K170 + X42 -> Q33756K27540X7434
D182 + S237 + U6 + I68 + K134 + M148 + O129 -> D18564S57354U228I4828K14472M30636O4902
Z27 + N67 -> Z189N11189
T174 + O203 + V224 + J249 + U183 + B174 + W175 + F132 -> T40020O15225V18144J30378U44286B522W22575F27192
I245 + S122 + C122 -> I50715S1342C25498
K35 + D227 -> K1365D49940
O19 + W113 + L39 + U146 -> O627W21357L1599U20294
U184 + E56 + K167 + L10 -> U33304E1736K2505L750
I146 + H171 + T219 + Q111 + X123 + B100 -> I4672H2565T17082Q9324X8241B4700
Z67 + T56 + X131 -> Z201T10808X15982
J74 + V85 + P197 + X43 + M39 -> J12950V4335P46492X3268M6864
W93 + V182 + P23 + C200 + B5 + R56 -> W7719V13650P5681C47400B1220R13552
A213 + I87 + Z180 + R229 + P124 + N39 -> A6177I3045Z34020R687P5704N3198
Y121 + Z147 -> Y242Z9555
V79 + L207 + A52 + P138 + W71 + M11 + F168 + O175 -> V17696L621A5876P27048W3266M957F23856O4025
F182 + C232 + O168 + I247 + L97 + T79 -> F33670C15080O28896I35815L12028T5767
R56 + N189 -> R8008N36477
H144 + T200 + S187 + Z62 + X107 + J188 -> H4176T1000S35343Z5828X15301J5640
R140 + F103 + M197 + G76 + O14 + U139 -> R31080F22145M6501G3116O1400U35584
M141 + F246 -> M3948F48216
N47 + Y171 + W17 -> N1316Y23085W884
Q84 + B13 + F98 + W158 + K29 + N143 + C91 + D181 -> Q17304B286F7840W39658K3132N34463C18200D22082
W174 + I58 + X141 + B154 -> W17748I812X8601B4004
L131 + O114 -> L9432O5586
L93 + U178 + O229 + J28 + F176 -> L19251U14596O18320J4788F15136
M196 + X135 + Q11 + Z192 + D35 + O19 + K121 -> M22932X19035Q2354Z34176D6965O4009K15367
X46 + V223 + L2 + D214 + Q39 + P19 + B189 -> X3726V54858L290D7276Q702P1254B25893
U248 + G128 + C157 + H252 + W163 + N100 + B116 + X132 -> U39680G27904C4553H61740W29992N5300B696X4092
A86 + V41 + D180 + P41 + S73 -> A3354V1271D28620P9225S14600
U71 + W148 + V190 + P84 + K218 + T75 + J11 + G39 -> U11786W25604V5510P19992K49704T5475J1727G6747
Y41 + O246 + L135 -> Y9717O46986L1080
E103 + R44 + A46 + N33 -> E13081R3828A10810N5313
G97 + Q177 + M123 + C96 + U198 + K122 + N7 -> G21437Q25488M22386C11520U11682K8784N1351
M214 + T208 -> M642T39728
X187 + G97 -> X2992G17557
L86 + K116 + H82 + A46 + T196 + R20 -> L21156K11252H20500A9292T7056R1320
D146 + K165 + W38 + C220 + V178 + O168 + Q242 + Y12 -> D12556K19965W1216C39380V19580O1176Q7986Y156
K32 + Z185 -> K1984Z7400
H193 + P58 + N121 + X25 + O67 + D197 -> H16598P2726N13189X1425O15611D28368
D197 + S73 + L138 + H209 + Z223 -> D3349S9344L18906H5434Z8920
V6 + B2 -> V1056B176
U245 + Q5 -> U50960Q245
S11 + V130 + M76 + X235 -> S2420V10920M6916X47470
A210 + N15 + M36 + V222 -> A3990N3405M1548V31302
G77 + A25 + M72 + B65 -> G12474A2750M17352B13585
P88 + C132 + R93 + I97 + O144 -> P12936C22440R20181I14841O23760
H55 + M27 + S3 + O247 + G167 + K35 + I225 -> H5775M3510S600O27911G668K8120I55800
A107 + N114 + T173 + P117 + D214 + W233 -> A27071N1482T22317P7488D21186W28426
Z36 + O40 + B156 -> Z2808O5880B27144
E123 + Z227 -> E16605Z3405
B128 + T131 + Q26 + H217 + D133 -> B14592T8777Q5044H3689D25669
S223 + G156 + N216 + R49 + Q60 + P158 + V23 -> S8697G29640N20520R490Q2520P33338V736
F78 + S4 + O201 -> F4836S844O23316
L24 + B150 + P207 + Z42 + F62 -> L360B16650P9522Z3906F124
V206 + X93 + S255 + Z79 + P253 + N173 -> V26574X6696S28305Z19987P43516N17473
O240 + Y170 + N58 + J211 + P117 + Z188 + T -> O20400Y12580N4292J28063P6552Z5640T192
R245 + I247 + U69 + M231 -> R50225I26182U17526M3696
U121 + M243 + Z122 + X252 + K78 -> U1936M22599Z10736X18396K1716
O48 + W69 -> O10896W8832
F235 + E32 + N221 -> F23500E7616N55029
P50 + Q104 + H11 + M186 + C33 + B27 -> P8950Q2496H935M32364C7656B1431"""
    )
)
